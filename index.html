import React, { useState } from 'react';
import { Plus, Fish, Calendar, Clock, Waves, Cloud, Moon, Users, MapPin, Trash2, Edit3, Save, X } from 'lucide-react';

const FishingLogApp = () => {
  const [trips, setTrips] = useState([]);
  const [showForm, setShowForm] = useState(false);
  const [editingTrip, setEditingTrip] = useState(null);
  const [activeTab, setActiveTab] = useState('details');
  
  const [companionsList, setCompanionsList] = useState([]);
  const [boatsList, setBoatsList] = useState(['Last Drop', 'Doc']);
  const [speciesList, setSpeciesList] = useState(['Snapper', 'Venus Tusk Fish', 'Teraglin', 'Mulloway', 'Longtail Tuna']);
  const [baitsList, setBaitsList] = useState(() => {
    const saved = localStorage.getItem('baitsList');
    return saved ? JSON.parse(saved) : ['Blue Pilchards', 'Squid'];
  });
  const [artificialBaitsList, setArtificialBaitsList] = useState(() => {
    try {
      const saved = localStorage.getItem('artificialBaitsList');
      return saved ? JSON.parse(saved) : [];
    } catch (error) {
      return [];
    }
  });
  const [locationsList, setLocationsList] = useState([]);
  
  const [currentTrip, setCurrentTrip] = useState({
    date: '',
    time: '',
    companions: '',
    fishingType: '',
    boatName: '',
    boatNotes: '',
    tide: '',
    tideTime: '',
    weather: '',
    windSpeed: '',
    windDirection: '',
    weatherNotes: '',
    moonPhase: '',
    catches: [],
    photos: []
  });
  
  const [newCatch, setNewCatch] = useState({
    species: '',
    number: '0',
    maxSize: '',
    baitType: '',
    bait: '',
    artificialDetails: '',
    location: '',
    gpsCoords: ''
  });
  
  const [showCatchForm, setShowCatchForm] = useState(false);
  const [showBoatInput, setShowBoatInput] = useState(false);
  const [newBoatName, setNewBoatName] = useState('');
  
  // PWA state
  const [showInstallPrompt, setShowInstallPrompt] = useState(false);
  const [deferredPrompt, setDeferredPrompt] = useState(null);

  // PWA Install Handler
  React.useEffect(() => {
    const handleBeforeInstallPrompt = (e) => {
      e.preventDefault();
      setDeferredPrompt(e);
      setShowInstallPrompt(true);
    };

    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);

    return () => {
      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
    };
  }, []);

  const handleInstallClick = async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') {
        setShowInstallPrompt(false);
      }
      setDeferredPrompt(null);
    }
  };

  const tideOptions = ['High', 'Low', 'Rising', 'Falling', 'Rising/High/Falling', 'Falling/Low/Rising'];
  const moonPhases = ['New Moon', 'Waxing Crescent', 'First Quarter', 'Waxing Gibbous', 'Full Moon', 'Waning Gibbous', 'Last Quarter', 'Waning Crescent'];
  const windDirections = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
  const windSpeedRanges = ['0 - 5', '5 - 10', '10 - 15', '15 - 20', '20 - 25'];
  const weatherOptions = ['Clear and sunny', 'Overcast', 'Showery', 'Rainy'];

  const getCurrentDate = () => {
    const now = new Date();
    return now.toISOString().split('T')[0];
  };

  const getCurrentTime = () => {
    const now = new Date();
    return now.toTimeString().slice(0, 5);
  };

  const getLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const coords = `${position.coords.latitude.toFixed(6)}, ${position.coords.longitude.toFixed(6)}`;
          setNewCatch(prev => ({ ...prev, gpsCoords: coords }));
        },
        () => {
          alert('Unable to get location. Please enter coordinates manually.');
        }
      );
    } else {
      alert('Geolocation is not supported by this browser.');
    }
  };

  const addCatch = () => {
    if (newCatch.species && newCatch.number) {
      if (newCatch.species && !speciesList.includes(newCatch.species)) {
        setSpeciesList(prev => [...prev, newCatch.species]);
      }
      
      if (newCatch.bait && !baitsList.includes(newCatch.bait) && newCatch.baitType === 'Natural Bait') {
        setBaitsList(prev => [...prev, newCatch.bait]);
      }
      
      if (newCatch.location && !locationsList.includes(newCatch.location)) {
        setLocationsList(prev => [...prev, newCatch.location]);
      }
      
      const catchToAdd = { ...newCatch, id: Date.now() };
      if (newCatch.baitType === 'Artificial Bait' && newCatch.artificialDetails) {
        catchToAdd.bait = `Artificial - ${newCatch.artificialDetails}`;
      }
      
      setCurrentTrip(prev => ({
        ...prev,
        catches: [...prev.catches, catchToAdd]
      }));
      
      setNewCatch({ species: '', number: '0', maxSize: '', baitType: '', bait: '', artificialDetails: '', location: '', gpsCoords: '' });
      setShowCatchForm(false);
    }
  };

  const removeCatch = (catchId) => {
    setCurrentTrip(prev => ({
      ...prev,
      catches: prev.catches.filter(c => c.id !== catchId)
    }));
  };

  const addNewBoat = () => {
    if (newBoatName.trim()) {
      setBoatsList(prev => [...prev, newBoatName.trim()]);
      setCurrentTrip(prev => ({ ...prev, boatName: newBoatName.trim() }));
      setNewBoatName('');
      setShowBoatInput(false);
    }
  };

  const saveTrip = () => {
    if (currentTrip.date && currentTrip.time) {
      const tripToSave = { ...currentTrip, id: editingTrip ? editingTrip.id : Date.now() };
      
      if (currentTrip.companions) {
        const newCompanions = currentTrip.companions.split(',').map(c => c.trim()).filter(c => c);
        const updatedCompanionsList = [...new Set([...companionsList, ...newCompanions])];
        setCompanionsList(updatedCompanionsList);
      }
      
      if (editingTrip) {
        setTrips(prev => prev.map(trip => trip.id === editingTrip.id ? tripToSave : trip));
        setEditingTrip(null);
      } else {
        setTrips(prev => [...prev, tripToSave]);
      }
      
      resetForm();
    } else {
      alert('Please fill in at least the date and time fields.');
    }
  };

  const resetForm = () => {
    setCurrentTrip({
      date: '',
      time: '',
      companions: '',
      fishingType: '',
      boatName: '',
      boatNotes: '',
      tide: '',
      tideTime: '',
      weather: '',
      windSpeed: '',
      windDirection: '',
      weatherNotes: '',
      moonPhase: '',
      catches: [],
      photos: []
    });
    setShowForm(false);
    setShowCatchForm(false);
    setActiveTab('details');
    setShowBoatInput(false);
    setNewBoatName('');
  };

  const editTrip = (trip) => {
    setCurrentTrip(trip);
    setEditingTrip(trip);
    setActiveTab('details');
    setShowForm(true);
  };

  const deleteTrip = (tripId) => {
    if (window.confirm('Are you sure you want to delete this trip?')) {
      setTrips(prev => prev.filter(trip => trip.id !== tripId));
    }
  };

  const startNewTrip = () => {
    setCurrentTrip({
      date: getCurrentDate(),
      time: getCurrentTime(),
      companions: '',
      fishingType: '',
      boatName: '',
      boatNotes: '',
      tide: '',
      tideTime: '',
      weather: '',
      windSpeed: '',
      windDirection: '',
      weatherNotes: '',
      moonPhase: '',
      catches: [],
      photos: []
    });
    setActiveTab('details');
    setShowForm(true);
  };

  const incrementCatch = () => {
    setNewCatch(prev => ({ 
      ...prev, 
      number: (parseInt(prev.number || '0') + 1).toString() 
    }));
  };

  const decrementCatch = () => {
    setNewCatch(prev => ({ 
      ...prev, 
      number: Math.max(0, parseInt(prev.number || '0') - 1).toString() 
    }));
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100">
      <div className="max-w-md mx-auto bg-white min-h-screen shadow-lg">
        <div className="bg-blue-600 text-white p-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-2">
              <Fish className="h-6 w-6" />
              <h1 className="text-xl font-bold">Fishing Log</h1>
            </div>
            <div className="flex space-x-2">
              {showInstallPrompt && (
                <button
                  onClick={handleInstallClick}
                  className="bg-green-500 hover:bg-green-400 p-2 rounded-full transition-colors"
                  title="Install App"
                >
                  <Download className="h-5 w-5" />
                </button>
              )}
              {!showForm && (
                <button
                  onClick={startNewTrip}
                  className="bg-blue-500 hover:bg-blue-400 p-2 rounded-full transition-colors"
                >
                  <Plus className="h-5 w-5" />
                </button>
              )}
            </div>
          </div>
          {showInstallPrompt && (
            <div className="mt-2 text-sm bg-green-500 bg-opacity-20 border border-green-400 rounded-lg p-2">
              <div className="flex items-center justify-between">
                <span>ðŸ“± Install this app for the best experience!</span>
                <button
                  onClick={() => setShowInstallPrompt(false)}
                  className="text-green-200 hover:text-white"
                >
                  <X className="h-4 w-4" />
                </button>
              </div>
            </div>
          )}
        </div>

        {showForm && (
          <div className="p-4 border-b bg-gray-50">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-lg font-semibold text-gray-800">
                {editingTrip ? 'Edit Trip' : 'New Trip'}
              </h2>
              <button onClick={resetForm} className="text-gray-500 hover:text-gray-700">
                <X className="h-5 w-5" />
              </button>
            </div>

            <div className="flex border-b border-gray-200 mb-4">
              <button
                onClick={() => setActiveTab('details')}
                className={`py-2 px-4 text-sm font-medium ${
                  activeTab === 'details'
                    ? 'border-b-2 border-blue-500 text-blue-600'
                    : 'text-gray-500 hover:text-gray-700'
                }`}
              >
                Details
              </button>
              <button
                onClick={() => setActiveTab('conditions')}
                className={`py-2 px-4 text-sm font-medium ${
                  activeTab === 'conditions'
                    ? 'border-b-2 border-blue-500 text-blue-600'
                    : 'text-gray-500 hover:text-gray-700'
                }`}
              >
                Conditions
              </button>
              <button
                onClick={() => setActiveTab('catches')}
                className={`py-2 px-4 text-sm font-medium ${
                  activeTab === 'catches'
                    ? 'border-b-2 border-blue-500 text-blue-600'
                    : 'text-gray-500 hover:text-gray-700'
                }`}
              >
                Catch
              </button>
              <button
                onClick={() => setActiveTab('photos')}
                className={`py-2 px-4 text-sm font-medium ${
                  activeTab === 'photos'
                    ? 'border-b-2 border-blue-500 text-blue-600'
                    : 'text-gray-500 hover:text-gray-700'
                }`}
              >
                Photos
              </button>
            </div>

            {activeTab === 'details' && (
              <div className="bg-white p-4 rounded-lg border-2 border-blue-200 shadow-sm">
                <h4 className="text-lg font-medium text-gray-800 mb-4">Trip Details</h4>
                
                <div className="space-y-4">
                  <div className="flex space-x-2">
                    <div className="flex-1">
                      <label className="flex items-center space-x-2 text-sm font-medium text-gray-700 mb-1">
                        <Calendar className="h-4 w-4" />
                        <span>Date</span>
                      </label>
                      <input
                        type="date"
                        value={currentTrip.date}
                        onChange={(e) => setCurrentTrip(prev => ({ ...prev, date: e.target.value }))}
                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                    <div className="flex-1">
                      <label className="flex items-center space-x-2 text-sm font-medium text-gray-700 mb-1">
                        <Clock className="h-4 w-4" />
                        <span>Time</span>
                      </label>
                      <input
                        type="time"
                        value={currentTrip.time}
                        onChange={(e) => setCurrentTrip(prev => ({ ...prev, time: e.target.value }))}
                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="flex items-center space-x-2 text-sm font-medium text-gray-700 mb-2">
                      <Users className="h-4 w-4" />
                      <span>Fishing Companions</span>
                    </label>
                    <select
                      value={currentTrip.companions}
                      onChange={(e) => setCurrentTrip(prev => ({ ...prev, companions: e.target.value }))}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-2"
                    >
                      <option value="">Select companions...</option>
                      {companionsList.map(companion => (
                        <option key={companion} value={companion}>{companion}</option>
                      ))}
                    </select>
                    <input
                      type="text"
                      placeholder="Or type names separated by commas"
                      value={currentTrip.companions}
                      onChange={(e) => setCurrentTrip(prev => ({ ...prev, companions: e.target.value }))}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>

                  <div>
                    <label className="text-sm font-medium text-gray-700 mb-2 block">Fishing Type</label>
                    <div className="flex space-x-4">
                      <label className="flex items-center">
                        <input
                          type="radio"
                          name="fishingType"
                          value="Land Based"
                          checked={currentTrip.fishingType === 'Land Based'}
                          onChange={(e) => setCurrentTrip(prev => ({ ...prev, fishingType: e.target.value, boatName: '', boatNotes: '' }))}
                          className="mr-2"
                        />
                        <span className="text-sm">Land Based</span>
                      </label>
                      <label className="flex items-center">
                        <input
                          type="radio"
                          name="fishingType"
                          value="Boat"
                          checked={currentTrip.fishingType === 'Boat'}
                          onChange={(e) => setCurrentTrip(prev => ({ ...prev, fishingType: e.target.value }))}
                          className="mr-2"
                        />
                        <span className="text-sm">Boat</span>
                      </label>
                    </div>
                    
                    {currentTrip.fishingType === 'Boat' && (
                      <div className="mt-3 space-y-3">
                        <div>
                          <label className="text-sm font-medium text-gray-700 mb-2 block">Boat Name</label>
                          <select
                            value={currentTrip.boatName}
                            onChange={(e) => {
                              if (e.target.value === 'add_new') {
                                setShowBoatInput(true);
                              } else {
                                setCurrentTrip(prev => ({ ...prev, boatName: e.target.value }));
                                setShowBoatInput(false);
                              }
                            }}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          >
                            <option value="">Select boat...</option>
                            {boatsList.map(boat => (
                              <option key={boat} value={boat}>{boat}</option>
                            ))}
                            <option value="add_new">+ Add New Boat</option>
                          </select>
                          
                          {showBoatInput && (
                            <div className="mt-2 flex space-x-2">
                              <input
                                type="text"
                                placeholder="Enter boat name"
                                value={newBoatName}
                                onChange={(e) => setNewBoatName(e.target.value)}
                                className="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              />
                              <button
                                onClick={addNewBoat}
                                className="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg text-sm font-medium"
                              >
                                Add
                              </button>
                              <button
                                onClick={() => {
                                  setShowBoatInput(false);
                                  setNewBoatName('');
                                }}
                                className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg text-sm font-medium"
                              >
                                Cancel
                              </button>
                            </div>
                          )}
                        </div>
                        
                        <div>
                          <label className="text-sm font-medium text-gray-700 mb-2 block">Boat Notes (optional)</label>
                          <input
                            type="text"
                            placeholder="e.g., berth location, engine details, equipment..."
                            value={currentTrip.boatNotes}
                            onChange={(e) => setCurrentTrip(prev => ({ ...prev, boatNotes: e.target.value }))}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          />
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'conditions' && (
              <div className="bg-white p-4 rounded-lg border-2 border-blue-200 shadow-sm">
                <h4 className="text-lg font-medium text-gray-800 mb-4">Conditions</h4>
                
                <div className="space-y-4">
                  <div>
                    <label className="flex items-center space-x-2 text-sm font-medium text-gray-700 mb-2">
                      <Waves className="h-4 w-4" />
                      <span>Tide</span>
                    </label>
                    <select
                      value={currentTrip.tide}
                      onChange={(e) => setCurrentTrip(prev => ({ ...prev, tide: e.target.value }))}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >
                      <option value="">Select tide...</option>
                      {tideOptions.map(tide => (
                        <option key={tide} value={tide}>{tide}</option>
                      ))}
                    </select>
                    {(currentTrip.tide === 'Rising/High/Falling' || currentTrip.tide === 'Falling/Low/Rising') && (
                      <div className="mt-3">
                        <label className="text-sm font-medium text-gray-700 mb-2 block">
                          Time of {currentTrip.tide === 'Rising/High/Falling' ? 'High' : 'Low'} Water
                        </label>
                        <input
                          type="time"
                          value={currentTrip.tideTime}
                          onChange={(e) => setCurrentTrip(prev => ({ ...prev, tideTime: e.target.value }))}
                          className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        />
                      </div>
                    )}
                  </div>

                  <div>
                    <label className="flex items-center space-x-2 text-sm font-medium text-gray-700 mb-2">
                      <Cloud className="h-4 w-4" />
                      <span>Weather</span>
                    </label>
                    <select
                      value={currentTrip.weather}
                      onChange={(e) => setCurrentTrip(prev => ({ ...prev, weather: e.target.value }))}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >
                      <option value="">Select weather...</option>
                      {weatherOptions.map(weather => (
                        <option key={weather} value={weather}>{weather}</option>
                      ))}
                    </select>
                  </div>

                  <div className="flex space-x-3">
                    <div className="flex-1">
                      <label className="text-sm font-medium text-gray-700 mb-2 block">Wind Speed (knots)</label>
                      <select
                        value={currentTrip.windSpeed}
                        onChange={(e) => setCurrentTrip(prev => ({ ...prev, windSpeed: e.target.value }))}
                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      >
                        <option value="">Select...</option>
                        {windSpeedRanges.map(range => (
                          <option key={range} value={range}>{range}</option>
                        ))}
                      </select>
                    </div>
                    <div className="flex-1">
                      <label className="text-sm font-medium text-gray-700 mb-2 block">Wind Direction</label>
                      <select
                        value={currentTrip.windDirection}
                        onChange={(e) => setCurrentTrip(prev => ({ ...prev, windDirection: e.target.value }))}
                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      >
                        <option value="">Select...</option>
                        {windDirections.map(dir => (
                          <option key={dir} value={dir}>{dir}</option>
                        ))}
                      </select>
                    </div>
                  </div>

                  <div>
                    <label className="flex items-center space-x-2 text-sm font-medium text-gray-700 mb-2">
                      <Moon className="h-4 w-4" />
                      <span>Moon Phase</span>
                    </label>
                    <select
                      value={currentTrip.moonPhase}
                      onChange={(e) => setCurrentTrip(prev => ({ ...prev, moonPhase: e.target.value }))}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >
                      <option value="">Select moon phase...</option>
                      {moonPhases.map(phase => (
                        <option key={phase} value={phase}>{phase}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="text-sm font-medium text-gray-700 mb-2 block">Weather Notes (optional)</label>
                    <input
                      type="text"
                      placeholder="e.g., gusty, steady, offshore breeze..."
                      value={currentTrip.weatherNotes}
                      onChange={(e) => setCurrentTrip(prev => ({ ...prev, weatherNotes: e.target.value }))}
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'catches' && (
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <h3 className="text-lg font-medium text-gray-700">Catch</h3>
                  <button
                    onClick={() => {
                      setNewCatch({ species: '', number: '0', maxSize: '', baitType: '', bait: '', artificialDetails: '', location: '', gpsCoords: '' });
                      setShowCatchForm(true);
                    }}
                    className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm flex items-center space-x-2"
                  >
                    <Plus className="h-4 w-4" />
                    <span>Add Catch</span>
                  </button>
                </div>

                {currentTrip.catches.map(catchItem => (
                  <div key={catchItem.id} className="bg-white p-4 rounded-lg border shadow-sm">
                    <div className="flex justify-between items-start">
                      <div className="flex-1">
                        <div className="font-semibold text-lg">{catchItem.species} ({catchItem.number})</div>
                        {catchItem.maxSize && <div className="text-sm text-gray-600 mt-1">Max Size: {catchItem.maxSize} cm</div>}
                        {catchItem.bait && <div className="text-sm text-gray-600">Bait: {catchItem.bait}</div>}
                        {catchItem.location && <div className="text-sm text-gray-600">Location: {catchItem.location}</div>}
                        {catchItem.gpsCoords && <div className="text-xs text-gray-500">GPS: {catchItem.gpsCoords}</div>}
                      </div>
                      <button
                        onClick={() => removeCatch(catchItem.id)}
                        className="text-red-500 hover:text-red-700 ml-3"
                      >
                        <Trash2 className="h-5 w-5" />
                      </button>
                    </div>
                  </div>
                ))}

                {showCatchForm && (
                  <div className="bg-white p-4 rounded-lg border-2 border-blue-200 shadow-sm">
                    <h4 className="text-lg font-medium text-gray-800 mb-4">Add New Catch</h4>
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Species</label>
                        <select
                          value={newCatch.species}
                          onChange={(e) => setNewCatch(prev => ({ ...prev, species: e.target.value }))}
                          className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        >
                          <option value="">Select species...</option>
                          {speciesList.map(species => (
                            <option key={species} value={species}>{species}</option>
                          ))}
                        </select>
                        <input
                          type="text"
                          placeholder="Or type species name"
                          value={newCatch.species}
                          onChange={(e) => setNewCatch(prev => ({ ...prev, species: e.target.value }))}
                          className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mt-2"
                        />
                      </div>

                      <div className="flex space-x-4">
                        <div className="flex-1">
                          <label className="block text-sm font-medium text-gray-700 mb-2">Number Caught</label>
                          <div className="flex items-center justify-center space-x-1">
                            <button
                              type="button"
                              onClick={decrementCatch}
                              className="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-4 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-xl"
                            >
                              âˆ’
                            </button>
                            <input
                              type="number"
                              min="0"
                              value={newCatch.number}
                              onChange={(e) => setNewCatch(prev => ({ ...prev, number: e.target.value }))}
                              className="w-16 text-center py-3 px-2 border-t border-b border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg font-semibold"
                            />
                            <button
                              type="button"
                              onClick={incrementCatch}
                              className="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-4 rounded-r-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-xl"
                            >
                              +
                            </button>
                          </div>
                        </div>
                        
                        <div className="flex-1">
                          <label className="block text-sm font-medium text-gray-700 mb-2">Max Size (cm)</label>
                          <input
                            type="number"
                            placeholder="Size in cm"
                            value={newCatch.maxSize}
                            onChange={(e) => setNewCatch(prev => ({ ...prev, maxSize: e.target.value }))}
                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          />
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Bait Type</label>
                        <div className="flex space-x-4 mb-3">
                          <label className="flex items-center">
                            <input
                              type="radio"
                              name="baitType"
                              value="Natural Bait"
                              checked={newCatch.baitType === 'Natural Bait'}
                              onChange={(e) => setNewCatch(prev => ({ ...prev, baitType: e.target.value, bait: '', artificialDetails: '' }))}
                              className="mr-2"
                            />
                            <span className="text-sm">Natural Bait</span>
                          </label>
                          <label className="flex items-center">
                            <input
                              type="radio"
                              name="baitType"
                              value="Artificial Bait"
                              checked={newCatch.baitType === 'Artificial Bait'}
                              onChange={(e) => setNewCatch(prev => ({ ...prev, baitType: e.target.value, bait: '', artificialDetails: '' }))}
                              className="mr-2"
                            />
                            <span className="text-sm">Artificial Bait</span>
                          </label>
                        </div>

                        {newCatch.baitType === 'Natural Bait' && (
                          <div className="p-3 bg-blue-50 border-2 border-blue-300 rounded-lg">
                            <label className="block text-sm font-medium text-blue-800 mb-2">
                              Natural Bait ({baitsList.length} saved)
                            </label>
                            <select
                              value={newCatch.bait}
                              onChange={(e) => setNewCatch(prev => ({ ...prev, bait: e.target.value }))}
                              className="w-full p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white mb-2"
                            >
                              <option value="">Select natural bait...</option>
                              {baitsList.map(bait => (
                                <option key={bait} value={bait}>{bait}</option>
                              ))}
                            </select>
                            <div className="flex space-x-2 mb-2">
                              <input
                                type="text"
                                placeholder="Type new natural bait"
                                value={newCatch.bait}
                                onChange={(e) => setNewCatch(prev => ({ ...prev, bait: e.target.value }))}
                                className="flex-1 p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"
                                onKeyPress={(e) => {
                                  if (e.key === 'Enter') {
                                    e.preventDefault();
                                    if (newCatch.bait && newCatch.bait.trim() && !baitsList.includes(newCatch.bait.trim())) {
                                      const newBait = newCatch.bait.trim();
                                      setBaitsList(prev => [...prev, newBait].sort());
                                    }
                                  }
                                }}
                              />
                              <button
                                type="button"
                                onClick={() => {
                                  if (newCatch.bait && newCatch.bait.trim() && !baitsList.includes(newCatch.bait.trim())) {
                                    const newBait = newCatch.bait.trim();
                                    setBaitsList(prev => [...prev, newBait].sort());
                                  }
                                }}
                                className="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded text-sm whitespace-nowrap transition-colors"
                              >
                                âž• Add
                              </button>
                            </div>
                            <div className="text-xs text-gray-600 mt-2">
                              Saved: {baitsList.join(', ') || 'None yet'}
                            </div>
                            <div className="text-xs text-blue-700 mt-1">
                              ðŸ’¡ Tip: Type new bait name and click "Add" or press Enter to save it for future trips
                            </div>
                          </div>
                        )}

                        {newCatch.baitType === 'Artificial Bait' && (
                          <div className="p-3 bg-blue-50 border-2 border-blue-300 rounded-lg">
                            <label className="block text-sm font-medium text-blue-800 mb-2">
                              Artificial Bait ({artificialBaitsList.length} saved)
                            </label>
                            <select
                              value={newCatch.bait}
                              onChange={(e) => setNewCatch(prev => ({ ...prev, bait: e.target.value }))}
                              className="w-full p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white mb-2"
                            >
                              <option value="">Select artificial bait...</option>
                              {artificialBaitsList.map(bait => (
                                <option key={bait} value={bait}>{bait}</option>
                              ))}
                            </select>
                            <div className="flex space-x-2 mb-2">
                              <input
                                type="text"
                                placeholder="Type new artificial bait"
                                value={newCatch.bait}
                                onChange={(e) => setNewCatch(prev => ({ ...prev, bait: e.target.value }))}
                                className="flex-1 p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"
                                onKeyPress={(e) => {
                                  if (e.key === 'Enter') {
                                    e.preventDefault();
                                    if (newCatch.bait && newCatch.bait.trim() && !artificialBaitsList.includes(newCatch.bait.trim())) {
                                      const newBait = newCatch.bait.trim();
                                      setArtificialBaitsList(prev => [...prev, newBait].sort());
                                    }
                                  }
                                }}
                              />
                              <button
                                type="button"
                                onClick={() => {
                                  if (newCatch.bait && newCatch.bait.trim() && !artificialBaitsList.includes(newCatch.bait.trim())) {
                                    const newBait = newCatch.bait.trim();
                                    setArtificialBaitsList(prev => [...prev, newBait].sort());
                                  }
                                }}
                                className="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded text-sm whitespace-nowrap transition-colors"
                              >
                                âž• Add
                              </button>
                            </div>
                            <div className="text-xs text-gray-600 mt-2">
                              Saved: {artificialBaitsList.join(', ') || 'None yet'}
                            </div>
                            <div className="text-xs text-blue-700 mt-1">
                              ðŸ’¡ Tip: Type new bait name and click "Add" or press Enter to save it for future trips
                            </div>
                          </div>
                        )}
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Location</label>
                        <select
                          value={newCatch.location}
                          onChange={(e) => setNewCatch(prev => ({ ...prev, location: e.target.value }))}
                          className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-2"
                        >
                          <option value="">Select location...</option>
                          {locationsList.map(location => (
                            <option key={location} value={location}>{location}</option>
                          ))}
                        </select>
                        <input
                          type="text"
                          placeholder="Or type location name"
                          value={newCatch.location}
                          onChange={(e) => setNewCatch(prev => ({ ...prev, location: e.target.value }))}
                          className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">GPS Coordinates</label>
                        <div className="flex space-x-2">
                          <input
                            type="text"
                            placeholder="GPS coordinates"
                            value={newCatch.gpsCoords}
                            onChange={(e) => setNewCatch(prev => ({ ...prev, gpsCoords: e.target.value }))}
                            className="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          />
                          <button
                            onClick={getLocation}
                            className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg flex items-center space-x-2"
                          >
                            <MapPin className="h-4 w-4" />
                            <span>GPS</span>
                          </button>
                        </div>
                      </div>

                      <div className="flex space-x-3 pt-4">
                        <button
                          onClick={addCatch}
                          className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 font-medium"
                        >
                          <Save className="h-4 w-4" />
                          <span>Add Catch</span>
                        </button>
                        <button
                          onClick={() => setShowCatchForm(false)}
                          className="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium"
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}

            {activeTab === 'photos' && (
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <h3 className="text-lg font-medium text-gray-700">Photos</h3>
                </div>

                <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-400 transition-colors">
                  <div className="space-y-3">
                    <div className="mx-auto h-12 w-12 text-gray-400">
                      <svg fill="none" stroke="currentColor" viewBox="0 0 48 48">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"/>
                      </svg>
                    </div>
                    <div>
                      <p className="text-sm text-gray-600">
                        <span className="font-medium text-blue-600 hover:text-blue-500 cursor-pointer">
                          Click to upload
                        </span>{' '}
                        or drag and drop
                      </p>
                      <p className="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                    </div>
                    <input
                      type="file"
                      multiple
                      accept="image/*"
                      onChange={(e) => {
                        const files = Array.from(e.target.files);
                        files.forEach(file => {
                          const reader = new FileReader();
                          reader.onload = (event) => {
                            const newPhoto = {
                              id: Date.now() + Math.random(),
                              name: file.name,
                              url: event.target.result,
                              size: file.size
                            };
                            setCurrentTrip(prev => ({
                              ...prev,
                              photos: [...prev.photos, newPhoto]
                            }));
                          };
                          reader.readAsDataURL(file);
                        });
                      }}
                      className="hidden"
                      id="photo-upload"
                    />
                    <label
                      htmlFor="photo-upload"
                      className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 cursor-pointer"
                    >
                      Choose Photos
                    </label>
                  </div>
                </div>

                {currentTrip.photos && currentTrip.photos.length > 0 && (
                  <div>
                    <h4 className="text-md font-medium text-gray-700 mb-3">Uploaded Photos ({currentTrip.photos.length})</h4>
                    <div className="grid grid-cols-2 gap-3">
                      {currentTrip.photos.map(photo => (
                        <div key={photo.id} className="relative bg-white rounded-lg border shadow-sm overflow-hidden">
                          <img
                            src={photo.url}
                            alt={photo.name}
                            className="w-full h-32 object-cover"
                          />
                          <div className="p-2">
                            <p className="text-xs text-gray-600 truncate">{photo.name}</p>
                            <p className="text-xs text-gray-400">{Math.round(photo.size / 1024)} KB</p>
                          </div>
                          <button
                            onClick={() => {
                              setCurrentTrip(prev => ({
                                ...prev,
                                photos: prev.photos.filter(p => p.id !== photo.id)
                              }));
                            }}
                            className="absolute top-1 right-1 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 text-xs"
                          >
                            <X className="h-3 w-3" />
                          </button>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            )}

            <div className="mt-6 pt-4 border-t">
              <button
                onClick={saveTrip}
                className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium flex items-center justify-center space-x-2 text-lg"
              >
                <Save className="h-5 w-5" />
                <span>{editingTrip ? 'Update Trip' : 'Save Trip'}</span>
              </button>
            </div>
          </div>
        )}

        <div className="p-4">
          {trips.length === 0 ? (
            <div className="text-center text-gray-500 py-12">
              <Fish className="h-16 w-16 mx-auto mb-4 opacity-50" />
              <p className="text-lg mb-2">No fishing trips logged yet.</p>
              <p className="text-sm">Tap the + button to add your first trip!</p>
            </div>
          ) : (
            <div className="space-y-4">
              {trips.map(trip => (
                <div key={trip.id} className="bg-white rounded-lg shadow-sm border p-4">
                  <div className="flex justify-between items-start mb-3">
                    <div className="flex-1">
                      <div className="flex items-center space-x-2 text-lg font-medium">
                        <Calendar className="h-4 w-4 text-blue-600" />
                        <span>{trip.date ? new Date(trip.date + 'T00:00:00').toLocaleDateString('en-GB') : ''}</span>
                        <Clock className="h-4 w-4 text-blue-600 ml-2" />
                        <span>{trip.time}</span>
                      </div>
                    </div>
                    <div className="flex space-x-2">
                      <button
                        onClick={() => editTrip(trip)}
                        className="text-blue-600 hover:text-blue-800"
                      >
                        <Edit3 className="h-4 w-4" />
                      </button>
                      <button
                        onClick={() => deleteTrip(trip.id)}
                        className="text-red-600 hover:text-red-800"
                      >
                        <Trash2 className="h-4 w-4" />
                      </button>
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-2 text-sm text-gray-600 mb-3">
                    {trip.tide && (
                      <div className="flex items-center space-x-1">
                        <Waves className="h-3 w-3" />
                        <span>{trip.tide}</span>
                        {trip.tideTime && (
                          <span className="text-xs ml-1">({trip.tideTime})</span>
                        )}
                      </div>
                    )}
                    {trip.weather && (
                      <div className="flex items-center space-x-1">
                        <Cloud className="h-3 w-3" />
                        <span>{trip.weather}</span>
                      </div>
                    )}
                    {trip.windSpeed && (
                      <div className="text-xs">
                        Wind: {trip.windSpeed}kts {trip.windDirection}
                        {trip.weatherNotes && <div className="text-gray-500">{trip.weatherNotes}</div>}
                      </div>
                    )}
                    {trip.moonPhase && (
                      <div className="flex items-center space-x-1">
                        <Moon className="h-3 w-3" />
                        <span className="text-xs">{trip.moonPhase}</span>
                      </div>
                    )}
                  </div>

                  {trip.companions && (
                    <div className="flex items-center space-x-1 text-sm text-gray-600 mb-2">
                      <Users className="h-3 w-3" />
                      <span>{trip.companions}</span>
                    </div>
                  )}

                  {trip.fishingType && (
                    <div className="text-sm text-gray-600 mb-2">
                      <div className="flex items-center space-x-1">
                        <span className="font-medium">{trip.fishingType}</span>
                        {trip.boatName && <span>- {trip.boatName}</span>}
                      </div>
                      {trip.boatNotes && <div className="text-xs text-gray-500 mt-1">{trip.boatNotes}</div>}
                    </div>
                  )}

                  {trip.catches.length > 0 && (
                    <div>
                      <h4 className="text-sm font-medium text-gray-700 mb-2">Catch:</h4>
                      {trip.catches.map(catchItem => (
                        <div key={catchItem.id} className="bg-gray-50 p-2 rounded text-sm mb-1">
                          <div className="font-medium">{catchItem.species} ({catchItem.number})</div>
                          {catchItem.maxSize && <div className="text-gray-600">Max Size: {catchItem.maxSize} cm</div>}
                          {catchItem.bait && <div className="text-gray-600">Bait: {catchItem.bait}</div>}
                          {catchItem.location && <div className="text-gray-600">Location: {catchItem.location}</div>}
                          {catchItem.gpsCoords && <div className="text-gray-500 text-xs">GPS: {catchItem.gpsCoords}</div>}
                        </div>
                      ))}
                    </div>
                  )}

                  {trip.photos && trip.photos.length > 0 && (
                    <div className="mt-3">
                      <h4 className="text-sm font-medium text-gray-700 mb-2">Photos ({trip.photos.length}):</h4>
                      <div className="grid grid-cols-3 gap-1">
                        {trip.photos.slice(0, 6).map(photo => (
                          <img
                            key={photo.id}
                            src={photo.url}
                            alt={photo.name}
                            className="w-full h-16 object-cover rounded border"
                          />
                        ))}
                        {trip.photos.length > 6 && (
                          <div className="w-full h-16 bg-gray-200 rounded border flex items-center justify-center text-xs text-gray-600">
                            +{trip.photos.length - 6} more
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default FishingLogApp;
Improve
Explain